.\"
.\"   $Id: lshell.1,v 1.17 2009-04-06 10:00:05 ghantoos Exp $
.\"
.\"   Man page for the Limited Shell (lshell) project.
.\"
.TH lshell 1 "March 20, 2009" "v0.9.0" 

.SH NAME
lshell \- Limited Shell

.SH SYNOPSIS
.B lshell 
[\fIOPTIONS\fR]

.SH DESCRIPTION
\fBlshell\fR provides a limited shell configured per user.
The configuration is done quite simply using a configuration file.
Coupled with ssh's 
.I authorized_keys 
or with
.I /etc/shells
and 
.I /etc/passwd
, it becomes very easy to restrict user's access to a limited set of command.

.SH OPTIONS
.TP
.B \--config \fI<FILE>\fR
Specify config file
.TP
.B \--log \fI<DIR>\fR
Specify the log directory
.TP
.B \-h, --help
Show help message
.TP
.B \--version
Show version

.SH CONFIGURATION
\fBlshell\fR configuration has 4 types of sections:
.RS
.ft 3
.nf
.sp
[global]   -> lshell system configuration (only 1)
[default]  -> lshell default user configuration (only 1)
[blah]     -> UNIX username "blah" specific configuration
[grp:blah] -> UNIX groupname "blah" specific configuration
.ft
.LP
.RE
.fi
Order of priority when loading preferences is the following:
.RS
.ft 3
.nf
.sp
1- User configuration
2- Group configuration
3- Default configuration
.ft
.LP
.RE
.fi
.SS [global]
.TP
.I logpath
config path (default is /var/log/lshell/)
.TP
.I loglevel
0, 1, 2, 3 or 4  (0: no logs -> 4: logs everything)
.SS [default] and/or [grp:groupname] and/or [username]
.TP
.I allowed
a list of the allowed commands or set to 'all' to allow all commands in user's \
PATH
.TP
.I forbidden
a list of forbidden character or commands
.TP
.I warning_counter
number of warnings when user enters a forbidden value before getting exited \
from lshell.
.TP
.I timer
a value in seconds for the session timer
.TP
.I passwd
password of specific user (default is empty)
.TP
.I path
list of path to restrict the user geographically
.TP
.I home_path
set the home folder of your user. If not specified, the home directory is set \
to the $HOME environment variable
.TP
.I env_path
update the environment variable $PATH of the user (optional)
.TP
.I scp
1 or 0 - to allow of forbid the use of scp connection
.TP
.I sftp
1 or 0 - to allow of forbid the use of sftp connection
.TP
.I overssh
list of command allowed to execute over ssh (e.g. rsync, rdiff-backup, scp, \
etc.)
.TP
.I strict
1 or 0 - If set to 1, any unknown command is considered as forbidden, and \
user's warning counter is decreased. If set to 0, command is considered as \
unknown, and user is only warned (i.e. *** unknown synthax)
.TP
.I scpforce
force files sent through scp to a specific directory
.TP
.I aliases
dict of command aliases (similar to bash's alias directive)

.SH TODO
.TP
In order to log a user's warnings into the logging directory (default \
\fI/var/log/lshell/\fR) , you must firt create the folder (if it doesn't \
exist yet) and chown it to lshellg group:
.RS
.ft 3
.nf
.sp
# mkdir /var/log/lshell
# chown :lshellg /var/log/lshell
# chmod 770 /var/log/lshell
.ft
.LP
.RE
.fi

then add the user to the \fIlshellg\fR group:
.RS
.ft 3
.nf
.sp
# usermod -aG lshellg user_name
.ft
.LP
.RE
.fi

In order to set lshell as default shell for a user:
.RS
.ft 3
.nf
.sp
On Linux:
# chsh -s /usr/bin/lshell user_name

On *BSD:
# chsh -s /usr/{pkg,local}/bin/lshell user_name
.ft
.LP
.RE
.fi

.SH EXAMPLES
.TP
.B $ lshell
.RS
Tries to run lshell using default ${PREFIX}/etc/lshell.conf as configuration \
file. If it fails a warning is printed and lshell is interrupted.
lshell options are loaded from the configuration file
.RE
.TP
.B $ lshell --config /path/to/myconf.file --log /path/to/mylog.log
.RS
This will override the default options specified for configuration and/or log \
file
.RE

.SH USE CASE
The primary goal of lshell, was to be able to create shell accounts \
with ssh access and restrict their environment to a couple a needed \
commands. 
In this example, User 'bla' and user 'blu' both belong to the 'users' UNIX \
group:
.TP
.B User bla:
.RS 
 - must be able to access /usr and /var but not /usr/local
 - user all command in his PATH but 'su'
 - has a warning counter set to 5
 - has his home path set to '/home/users'
.RE
.TP
.B User blu:
.RS
 - must be able to access /etc and /usr but not /usr/local
 - is allowed default commands plus 'ping' minus 'ls'
 - strictness is set to 1 (meaning he is not allowed to type an unknown command)
.RE

In this case, my configuration file will look something like this:
.RS
.ft 3
.nf
.sp
# CONFIURATION START
[global]
logpath         : /var/log/lshell/
loglevel        : 2

[default]
allowed         : ['ls','pwd']
forbidden       : [';', '&', '|'] 
warning_counter : 2
timer           : 0
path            : ['/etc', '/usr']
env_path        : ':/sbin:/usr/bla'
scp             : 1 # or 0
sftp            : 1 # or 0
overssh         : ['rsync','ls']
aliases         : {'ls':'ls --color=auto','ll':'ls -l'}

[grp:users]
warning_counter : 5
overssh         ! - ['ls']

[bla]
allowed         : 'all' - ['su']
path            : ['/var', '/usr'] - ['/usr/local']
home_path       : '/home/users'

[blu]
allowed         : + ['ping'] - ['ls'] 
path            : - ['/usr/local']
strict          : 1
scpforce        : '/home/blu/uploads/'
# CONFIURATION END
.ft
.LP
.RE
.fi

.SH AUTHOR
Currently maintained by Ignace Mouzannar -ghantoos- 

.SH EMAIL
Feel free to send me your recommendations at <ghantoos@ghantoos.org>
